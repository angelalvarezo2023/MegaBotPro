<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MegaBot PRO - Control Remoto</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .container {
      width: 100%;
      max-width: 400px;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    }
    
    .logo {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .logo h1 {
      color: white;
      font-size: 28px;
      margin-bottom: 5px;
    }
    
    .logo p {
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
    }
    
    /* Panel de Login */
    #login-panel {
      display: block;
    }
    
    #control-panel {
      display: none;
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-group label {
      display: block;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
      margin-bottom: 8px;
    }
    
    .input-group input {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      text-align: center;
      text-transform: uppercase;
      background: rgba(255, 255, 255, 0.9);
    }
    
    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
    }
    
    .btn:hover {
      transform: scale(1.02);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .status-message {
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 15px;
      font-size: 14px;
    }
    
    .status-success {
      background: rgba(16, 185, 129, 0.3);
      color: #6ee7b7;
    }
    
    .status-error {
      background: rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }
    
    .status-info {
      background: rgba(59, 130, 246, 0.3);
      color: #93c5fd;
    }
    
    /* Panel de Control */
    .info-card {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .info-row:last-child {
      border-bottom: none;
    }
    
    .info-label {
      color: rgba(255, 255, 255, 0.6);
      font-size: 13px;
    }
    
    .info-value {
      color: white;
      font-weight: bold;
      font-size: 14px;
    }
    
    .status-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .badge-active {
      background: #10b981;
      color: white;
    }
    
    .badge-paused {
      background: #ef4444;
      color: white;
    }
    
    .badge-pro {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
    }
    
    .badge-basico {
      background: #6b7280;
      color: white;
    }
    
    .control-buttons {
      display: grid;
      gap: 10px;
      margin-top: 20px;
    }
    
    .divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.1);
      margin: 20px 0;
    }
    
    .logout-btn {
      margin-top: 15px;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
      padding: 10px;
    }
    
    .refresh-info {
      text-align: center;
      color: rgba(255, 255, 255, 0.4);
      font-size: 11px;
      margin-top: 15px;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="logo">
        <h1>üöÄ MegaBot PRO</h1>
        <p>Control Remoto</p>
      </div>
      
      <!-- Panel de Login -->
      <div id="login-panel">
        <div class="input-group">
          <label>üîë Ingresa tu clave de licencia</label>
          <input type="text" id="clave-input" placeholder="MEGA-ANDY-001">
        </div>
        
        <div id="login-status" class="status-message hidden"></div>
        
        <button class="btn btn-primary" id="btn-login" onclick="verificarClave()">
          Acceder
        </button>
      </div>
      
      <!-- Panel de Control -->
      <div id="control-panel">
        <div class="info-card">
          <div class="info-row">
            <span class="info-label">üë§ Cliente</span>
            <span class="info-value" id="info-cliente">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">üìã Plan</span>
            <span id="info-plan"></span>
          </div>
          <div class="info-row">
            <span class="info-label">üìÖ D√≠as restantes</span>
            <span class="info-value" id="info-dias">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">üîÑ Estado</span>
            <span id="info-estado"></span>
          </div>
        </div>
        
        <div id="control-status" class="status-message hidden"></div>
        
        <div class="control-buttons">
          <button class="btn btn-danger" id="btn-pausar" onclick="pausarCuenta('esta')">
            ‚è∏Ô∏è Pausar esta cuenta
          </button>
          <button class="btn btn-danger" id="btn-pausar-todas" onclick="pausarCuenta('todas')">
            ‚è∏Ô∏è Pausar TODAS las cuentas
          </button>
          
          <div class="divider"></div>
          
          <button class="btn btn-success" id="btn-reanudar" onclick="reanudarCuenta('esta')">
            ‚ñ∂Ô∏è Reanudar esta cuenta
          </button>
          <button class="btn btn-success" id="btn-reanudar-todas" onclick="reanudarCuenta('todas')">
            ‚ñ∂Ô∏è Reanudar TODAS las cuentas
          </button>
        </div>
        
        <button class="btn logout-btn" onclick="cerrarSesion()">
          üö™ Cerrar sesi√≥n
        </button>
        
        <p class="refresh-info">
          Se actualiza cada 10 segundos
        </p>
      </div>
    </div>
  </div>

  <script>
    // ========== CONFIGURACI√ìN ==========
    // PEGA AQU√ç TU URL DE GOOGLE APPS SCRIPT
    const API_URL = "https://script.google.com/macros/s/AKfycbwjkp_ahJXrKuCVfOeDR6anu3M_7XSF8eOPmGHrpwt_hBfkdCEX8GsK2jbvT7HyXShMCg/exec";
    
    // ========== VARIABLES ==========
    let claveActual = localStorage.getItem("megabot_remote_key") || "";
    let intervaloActualizacion = null;
    
    // ========== INICIALIZACI√ìN ==========
    document.addEventListener("DOMContentLoaded", () => {
      if (claveActual) {
        verificarClave(claveActual);
      }
      
      // Enter para login
      document.getElementById("clave-input").addEventListener("keypress", (e) => {
        if (e.key === "Enter") verificarClave();
      });
    });
    
    // ========== FUNCIONES API ==========
    async function callAPI(action, params = {}) {
      try {
        const url = new URL(API_URL);
        url.searchParams.append("action", action);
        
        for (const [key, value] of Object.entries(params)) {
          url.searchParams.append(key, value);
        }
        
        const response = await fetch(url.toString());
        return await response.json();
      } catch (error) {
        console.error("Error API:", error);
        return { error: error.message };
      }
    }
    
    // ========== VERIFICAR CLAVE ==========
    async function verificarClave(claveGuardada = null) {
      const clave = claveGuardada || document.getElementById("clave-input").value.trim().toUpperCase();
      
      if (!clave) {
        mostrarStatus("login-status", "‚ö†Ô∏è Ingresa una clave", "error");
        return;
      }
      
      const btn = document.getElementById("btn-login");
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span>';
      
      mostrarStatus("login-status", "Verificando...", "info");
      
      const resultado = await callAPI("verificar", { clave });
      
      btn.disabled = false;
      btn.textContent = "Acceder";
      
      if (resultado.encontrada) {
        claveActual = clave;
        localStorage.setItem("megabot_remote_key", clave);
        mostrarPanelControl(resultado);
        ocultarStatus("login-status");
      } else {
        mostrarStatus("login-status", "‚ùå Clave no encontrada", "error");
        localStorage.removeItem("megabot_remote_key");
      }
    }
    
    // ========== MOSTRAR PANEL DE CONTROL ==========
    function mostrarPanelControl(datos) {
      document.getElementById("login-panel").style.display = "none";
      document.getElementById("control-panel").style.display = "block";
      
      actualizarInfoPanel(datos);
      
      // Iniciar actualizaci√≥n autom√°tica
      if (intervaloActualizacion) clearInterval(intervaloActualizacion);
      intervaloActualizacion = setInterval(actualizarEstado, 10000);
    }
    
    function actualizarInfoPanel(datos) {
      document.getElementById("info-cliente").textContent = datos.cliente || "-";
      document.getElementById("info-dias").textContent = datos.diasRestantes + " d√≠as";
      
      // Plan badge
      const planBadge = datos.plan === "pro" 
        ? '<span class="status-badge badge-pro">PRO</span>'
        : '<span class="status-badge badge-basico">B√ÅSICO</span>';
      document.getElementById("info-plan").innerHTML = planBadge;
      
      // Estado badge
      const estaPausado = datos.pausado === "SI" || datos.pausadoTodas === "SI" || 
                          datos.pausado === true || datos.pausadoTodas === true;
      const estadoBadge = estaPausado
        ? '<span class="status-badge badge-paused">‚è∏Ô∏è PAUSADO</span>'
        : '<span class="status-badge badge-active">‚ñ∂Ô∏è ACTIVO</span>';
      document.getElementById("info-estado").innerHTML = estadoBadge;
    }
    
    // ========== ACTUALIZAR ESTADO ==========
    async function actualizarEstado() {
      if (!claveActual) return;
      
      const resultado = await callAPI("verificar", { clave: claveActual });
      
      if (resultado.encontrada) {
        actualizarInfoPanel(resultado);
      }
    }
    
    // ========== PAUSAR CUENTA ==========
    async function pausarCuenta(tipo) {
      const btn = tipo === "todas" 
        ? document.getElementById("btn-pausar-todas")
        : document.getElementById("btn-pausar");
      
      const textoOriginal = btn.textContent;
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> Pausando...';
      
      const resultado = await callAPI("pausar", { clave: claveActual, tipo });
      
      btn.disabled = false;
      btn.textContent = textoOriginal;
      
      if (resultado.success) {
        mostrarStatus("control-status", "‚úÖ " + resultado.mensaje, "success");
        await actualizarEstado();
      } else {
        mostrarStatus("control-status", "‚ùå " + (resultado.error || "Error"), "error");
      }
      
      setTimeout(() => ocultarStatus("control-status"), 3000);
    }
    
    // ========== REANUDAR CUENTA ==========
    async function reanudarCuenta(tipo) {
      const btn = tipo === "todas" 
        ? document.getElementById("btn-reanudar-todas")
        : document.getElementById("btn-reanudar");
      
      const textoOriginal = btn.textContent;
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> Reanudando...';
      
      const resultado = await callAPI("reanudar", { clave: claveActual, tipo });
      
      btn.disabled = false;
      btn.textContent = textoOriginal;
      
      if (resultado.success) {
        mostrarStatus("control-status", "‚úÖ " + resultado.mensaje, "success");
        await actualizarEstado();
      } else {
        mostrarStatus("control-status", "‚ùå " + (resultado.error || "Error"), "error");
      }
      
      setTimeout(() => ocultarStatus("control-status"), 3000);
    }
    
    // ========== CERRAR SESI√ìN ==========
    function cerrarSesion() {
      claveActual = "";
      localStorage.removeItem("megabot_remote_key");
      
      if (intervaloActualizacion) {
        clearInterval(intervaloActualizacion);
        intervaloActualizacion = null;
      }
      
      document.getElementById("login-panel").style.display = "block";
      document.getElementById("control-panel").style.display = "none";
      document.getElementById("clave-input").value = "";
    }
    
    // ========== HELPERS ==========
    function mostrarStatus(id, mensaje, tipo) {
      const el = document.getElementById(id);
      el.textContent = mensaje;
      el.className = `status-message status-${tipo}`;
      el.classList.remove("hidden");
    }
    
    function ocultarStatus(id) {
      document.getElementById(id).classList.add("hidden");
    }
  </script>
</body>
</html>
